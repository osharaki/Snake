import pygame, sys
import pygame.locals as GAME_GLOBALS
import pygame.event as GAME_EVENTS
import objects



windowHeight = 500
windowWidth = 500
#dirChangeDelay = 30
myGrid = objects.Field(windowWidth, windowHeight)
'''
WIDTH = 10 # square width
HEIGHT = 10 # square height
MARGIN = 0  # distance between squares
'''


pygame.init()
pygame.font.init()

surface = pygame.display.set_mode((myGrid.windowWidth, myGrid.windowHeight))
pygame.display.set_caption('Snake!')

#Mouse Variables
mousePosition = (0,0)
mouseStates = None
mouseDown = False

BLACK = (0, 0, 0)
WHITE = (255, 255, 255)
GREEN = (0, 255, 0)
RED = (255, 0, 0)

# screen text
font = pygame.font.Font(None, 30)
#size = font.size("koko!")


snake = objects.Snake(myGrid, GREEN)
dot = objects.Dot(myGrid, snake, WHITE)
#snake.printRowCol()
#grid = [[0 for x in range(blocksInRow)] for y in range(blocksInCol)]

def updateGame():

  global mouseDown, gameOver, ren
  '''
  if mouseStates[0] is 1 and mouseDown is False:
      mouseDown = True

      # Change the x/y screen coordinates to grid coordinates
      column = mousePosition[0] // (WIDTH + MARGIN)
      row = mousePosition[1] // (HEIGHT + MARGIN)
      if row >= 10:
          row = 9
      if column >= 10:
          column = 9
      # Set that location to one
      myGrid[row][column] = 1

  elif mouseStates[0] is 0 and mouseDown is True:
    mouseDown = False
  '''
  ren = font.render(str(snake.score), 0, RED)
  snake.checkImpact(myGrid)
  snake.move()
  dot.checkEaten(myGrid, snake)
  dot.place(myGrid, snake)

def drawGame():

    surface.fill(BLACK)

    # Draw the grid
    '''
    for row in range(myGrid.blocksInRow):
        for column in range(myGrid.blocksInCol):
            color = BLACK
            if myGrid.grid[row][column] == 1:
                color = GREEN
            pygame.draw.rect(surface,
                             color,
                             [(myGrid.MARGIN + myGrid.WIDTH) * column + myGrid.MARGIN,
                              (myGrid.MARGIN + myGrid.HEIGHT) * row + myGrid.MARGIN,
                              myGrid.WIDTH,
                              myGrid.HEIGHT])
    '''

    if snake.hit:
        snake.color = RED
    # Draw the snake
    for bb in snake.body:
        pygame.draw.rect(surface,
                             snake.color,
                             [(myGrid.MARGIN + myGrid.WIDTH) * bb[1] + myGrid.MARGIN,
                              (myGrid.MARGIN + myGrid.HEIGHT) * bb[0] + myGrid.MARGIN,
                              myGrid.WIDTH,
                              myGrid.HEIGHT])
    pygame.draw.rect(surface,
                             dot.color,
                             [(myGrid.MARGIN + myGrid.WIDTH) * dot.pos[1] + myGrid.MARGIN,
                              (myGrid.MARGIN + myGrid.HEIGHT) * dot.pos[0] + myGrid.MARGIN,
                              myGrid.WIDTH,
                              myGrid.HEIGHT])
    surface.blit(ren, (10, 10))

def quitGame():
  pygame.quit()
  sys.exit()

clock = pygame.time.Clock()
'''
# Change the x/y screen coordinates to grid coordinates and place first square in the middle of the screen
column = myGrid.blocksInCol//2
row = myGrid.blocksInRow//2

# prevents index out of range exception
if row >= myGrid.blocksInRow:
    row = myGrid.blocksInRow-1
if column >= myGrid.blocksInCol:
    column = myGrid.blocksInCol-1
'''
# Set that location to one
#myGrid.grid[40][45] = 1

#lastDirChange = GAME_TIME.get_ticks() + 50
#print(myGrid.blocksInCol)
#print(myGrid.windowWidth)
#print(myGrid.windowHeight)

while True:

    #print(snake.direction)
    #print(snake.body[0][1])
    mousePosition = pygame.mouse.get_pos()
    mouseStates = pygame.mouse.get_pressed()

    updateGame()
    drawGame()

    if mouseStates[0] is 0 and mouseDown is True:
      mouseDown = False

    # Handle user and system events
    for event in GAME_EVENTS.get():

        if event.type == pygame.KEYDOWN:
            if event.key == pygame.K_LEFT:  # while moving right, pressing left should have no effect, we also prevent the snake from phasing into itself
                if snake.direction != objects.Direction.right \
                        and not ((snake.body[0][0] == snake.body[1][0])
                                and (snake.body[0][1] - 1 == snake.body[1][1])):
                    snake.direction = objects.Direction.left
            if event.key == pygame.K_RIGHT: # while moving left, pressing right should have no effect, we also prevent the snake from phasing into itself
                if snake.direction != objects.Direction.left \
                        and not ((snake.body[0][0] == snake.body[1][0])
                                and (snake.body[0][1] + 1 == snake.body[1][1])):
                    snake.direction = objects.Direction.right
            if event.key == pygame.K_UP:    # while moving down, pressing up should have no effect, we also prevent the snake from phasing into itself
                if snake.direction != objects.Direction.down\
                        and not ((snake.body[0][0] - 1 == snake.body[1][0])
                                and (snake.body[0][1] == snake.body[1][1])):
                    snake.direction = objects.Direction.up
            if event.key == pygame.K_DOWN:  # while moving up, pressing down should have no effect, we also prevent the snake from phasing into itself
                if snake.direction != objects.Direction.up\
                        and not ((snake.body[0][0] + 1 == snake.body[1][0])
                                and (snake.body[0][1] == snake.body[1][1])):
                    snake.direction = objects.Direction.down
            if event.key == pygame.K_ESCAPE:
                quitGame()

        if event.type == GAME_GLOBALS.QUIT:
            quitGame()


    clock.tick(60)
    pygame.display.update()